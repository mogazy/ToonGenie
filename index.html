<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿ±ŸÅŸäŸÇÿ™ŸÉ ÿßŸÑŸÑÿ∑ŸäŸÅÿ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Tajawal:wght@400;700&display=swap');

        :root {
            --primary: #f472b6; 
            --bg-color: #f3f4f6;
            --terminal-bg: #ffffff;
            --accent: #000000;
        }

        body {
            background-color: var(--bg-color);
            font-family: 'Tajawal', sans-serif;
            color: var(--accent);
            overflow: hidden;
            transition: background-color 0.8s ease;
        }

        .terminal-container {
            border: 4px solid var(--accent);
            background: var(--terminal-bg);
            box-shadow: 12px 12px 0px rgba(0,0,0,0.1);
            height: 80vh;
        }

        .status-monitor {
            font-family: 'VT323', monospace;
            background: #000;
            color: #ffffff; 
            border: 2px solid var(--accent);
            padding: 8px 25px;
            font-size: 1.5rem;
            min-width: 120px;
            text-align: center;
        }

        .retro-button {
            border: 3px solid var(--accent);
            background: var(--primary);
            color: #fff;
            font-weight: bold;
            padding: 12px 25px;
            box-shadow: 4px 4px 0px var(--accent);
        }

        .retro-button:active:not(:disabled) {
            box-shadow: 0px 0px 0px var(--accent);
            transform: translate(4px, 4px);
        }

        .chat-canvas {
            background-image: radial-gradient(#00000010 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .bubble {
            border: 2px solid var(--accent);
            padding: 12px 16px;
            max-width: 85%;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.05);
            line-height: 1.6;
            position: relative;
        }

        .bubble-user {
            background: #ffffff;
            align-self: flex-start;
            border-style: dashed;
        }

        .bubble-bot {
            background: #ffffff;
            align-self: flex-end;
            border-style: solid;
        }

        .bubble strong { font-weight: bold; color: #be185d; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #000; border-radius: 0px; }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div class="mb-6">
        <div id="emotion-status" class="status-monitor">
            NORMAL
        </div>
    </div>

    <div class="w-full max-w-2xl terminal-container flex flex-col">
        <div class="bg-black text-white p-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div id="active-led" class="w-3 h-3 bg-green-500 rounded-full"></div>
                <span id="ai-name-display" class="font-bold text-xs uppercase tracking-widest text-pink-400">ÿ™ÿ≠ŸÖŸäŸÑ...</span>
            </div>
        </div>

        <div id="chat-box" class="flex-1 overflow-y-auto p-4 flex flex-col gap-4 chat-canvas"></div>

        <div class="p-4 border-t-4 border-black bg-white">
            <div class="flex gap-2">
                <input id="user-msg" type="text" placeholder="ÿßŸÉÿ™ÿ® ŸÑÿ±ŸÅŸäŸÇÿ™ŸÉ..." 
                    class="flex-1 p-3 border-2 border-black focus:outline-none focus:ring-2 focus:ring-pink-300"
                    onkeypress="if(event.key === 'Enter') handleExecution()">
                <button id="exec-btn" onclick="handleExecution()" class="retro-button">ÿ•ÿ±ÿ≥ÿßŸÑ</button>
            </div>
        </div>
    </div>

    <script>
        let aiName = "";
        let chatHistory = [];

        window.onload = () => {
            aiName = prompt("ŸÖÿßÿ∞ÿß ÿ™ÿ±ŸäÿØ ÿ£ŸÜ ÿ™ÿ≥ŸÖŸä ÿ±ŸÅŸäŸÇÿ™ŸÉÿü") || "ÿ¥Ÿäÿ±Ÿä";
            document.getElementById('ai-name-display').innerText = aiName;
            
            const systemPrompt = `ÿ£ŸÜÿ™Ÿê ${aiName}ÿå ÿ±ŸÅŸäŸÇÿ© ŸÑÿ∑ŸäŸÅÿ©.
            ŸÇÿßÿπÿØÿ© ÿ™ŸÇŸÜŸäÿ© ŸÖÿ∑ŸÑŸÇÿ©: Ÿäÿ¨ÿ® ÿ£ŸÜ Ÿäÿ™ÿ∂ŸÖŸÜ ÿ±ÿØŸÉ ŸÉŸàÿØ ÿßŸÑÿ¥ÿπŸàÿ± ŸÅŸÇÿ∑ ŸàŸáŸà: ha ÿ£Ÿà sa ÿ£Ÿà an.
            - ha = ÿ≥ÿπŸäÿØ
            - sa = ÿ≠ÿ≤ŸäŸÜ
            - an = ÿ∫ÿßÿ∂ÿ®
            ÿ∂ÿπŸä ÿßŸÑŸÉŸàÿØ ŸÅŸä ÿ£Ÿä ŸÖŸÉÿßŸÜÿå ÿ≥ÿ£ŸÇŸàŸÖ ÿ£ŸÜÿß ÿ®ÿ•ÿÆŸÅÿßÿ¶Ÿá. ÿ™ÿ≠ÿØÿ´Ÿä ÿ®ŸÑŸáÿ¨ÿ© ŸàÿØŸàÿØÿ© ÿ¨ÿØÿßŸã Ÿàÿ®ÿ≥Ÿäÿ∑ÿ©.`;
            
            chatHistory.push({ role: "system", content: systemPrompt });
            appendBubble('bot', `ŸáŸäŸáŸä.. ÿ£ŸáŸÑÿßŸã ÿ®ŸÉ! ÿ£ŸÜÿß **${aiName}**.. ÿ≥ÿπŸäÿØÿ© ÿ¨ÿØÿßŸã ÿ®Ÿàÿ¨ŸàÿØŸÉ ŸÖÿπŸä! üå∏`);
        };

        const CONFIG = {
            GROQ: {
                key: "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",
                url: "https://api.groq.com/openai/v1/chat/completions",
                model: "llama-3.3-70b-versatile"
            },
            GEMINI: {
                key: "AIzaSyAqQeLvupdu69LOHsFx6PR2txK6OQUx-MM",
                url: "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent"
            }
        };

        async function handleExecution() {
            const input = document.getElementById('user-msg');
            const text = input.value.trim();
            if (!text) return;

            setUIState(true);
            appendBubble('user', text);
            input.value = '';
            chatHistory.push({ role: "user", content: text });

            let reply = await executeGroq() || await executeGemini();

            if (reply) {
                processResponse(reply);
            } else {
                appendBubble('bot', "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£.. ÿ≠ÿßŸàŸÑŸä ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ Ÿäÿß ÿπÿ≤Ÿäÿ≤Ÿä üå∏");
            }
            setUIState(false);
        }

        async function executeGroq() {
            try {
                const res = await fetch(CONFIG.GROQ.url, {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${CONFIG.GROQ.key}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: CONFIG.GROQ.model, messages: chatHistory, temperature: 0.7 })
                });
                if (res.ok) {
                    const d = await res.json();
                    return d.choices[0].message.content;
                }
            } catch (e) {}
            return null;
        }

        async function executeGemini() {
            try {
                const history = chatHistory.slice(1).map(m => ({
                    role: m.role === 'assistant' ? 'model' : 'user',
                    parts: [{ text: m.content }]
                }));
                const res = await fetch(`${CONFIG.GEMINI.url}?key=${CONFIG.GEMINI.key}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        contents: history, 
                        systemInstruction: { parts: [{ text: chatHistory[0].content }] }
                    })
                });
                if (res.ok) {
                    const d = await res.json();
                    return d.candidates[0].content.parts[0].text;
                }
            } catch (e) {}
            return null;
        }

        function processResponse(text) {
            const codeRegex = /\[?(ha|sa|an)\]?/gi;
            const match = text.match(codeRegex);
            let currentMood = "ha";

            if (match) {
                currentMood = match[0].replace(/[\[\]]/g, '').toLowerCase().substring(0, 2);
            }

            updateMoodUI(currentMood);

            const cleanText = text.replace(codeRegex, '').trim();
            appendBubble('bot', cleanText || "...");
            chatHistory.push({ role: "assistant", content: text });
        }

        function updateMoodUI(mood) {
            const statusBox = document.getElementById('emotion-status');
            let color = "#f3f4f6";
            let label = "NORMAL";

            if (mood === "ha") {
                color = "#FFC9F5"; // Ÿàÿ±ÿØŸä ŸÖÿ¥ÿ±ŸÇ (ÿ≥ÿπŸäÿØ)
                label = "HAPPY";
            } else if (mood === "sa") {
                color = "#858585"; // ÿ±ŸÖÿßÿØŸä (ÿ≠ÿ≤ŸäŸÜ)
                label = "SAD";
            } else if (mood === "an") {
                color = "#FF7373"; // ÿ£ÿ≠ŸÖÿ± (ÿ∫ÿßÿ∂ÿ®)
                label = "ANGRY";
            }

            document.body.style.backgroundColor = color;
            statusBox.innerText = label;
        }

        function appendBubble(sender, text) {
            const div = document.createElement('div');
            div.className = `bubble ${sender === 'user' ? 'bubble-user' : 'bubble-bot'}`;
            div.innerHTML = sender === 'bot' ? marked.parse(text) : text;
            const container = document.getElementById('chat-box');
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function setUIState(isLoading) {
            const btn = document.getElementById('exec-btn');
            const inp = document.getElementById('user-msg');
            const led = document.getElementById('active-led');
            
            btn.disabled = isLoading;
            inp.disabled = isLoading;
            led.style.backgroundColor = isLoading ? "#f472b6" : "#22c55e";
        }
    </script>
</body>
</html>
